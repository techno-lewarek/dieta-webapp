<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Kalkulator Delegacji + PDF</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #f5f5f5; text-align: center; }
        h1 { margin-top: 0.5em; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 1em; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background: #e0e0e0; }
        input, select { width: 100%; padding: 4px; box-sizing: border-box; }
        .btn { padding: 10px 20px; margin: 1em 0; font-size: 1em; cursor: pointer; }
        #generatePDF { background: #007bff; color: white; border: none; border-radius: 4px; }
        .logo { max-width: 150px; margin: 0 auto 20px; display: block; }
    </style>
</head>
<body>
    <img src="logo.png" alt="Logo" class="logo">
    <h1>Kalkulator Diety Krajowej</h1>

    <label for="delegationNumber">Numer delegacji służbowej:</label>
    <input type="text" id="delegationNumber" placeholder="np. KB/001/2025">

    <table id="delegationTable">
        <thead>
            <tr>
                <th>Wyjazd - miejscowość</th>
                <th>Data</th>
                <th>Godzina</th>
                <th>Przyjazd - miejscowość</th>
                <th>Data</th>
                <th>Godzina</th>
                <th>Środek lokomocji</th>
                <th>Koszt przejazdu (zł)</th>
                <th>km (jeśli prywatne)</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <button class="btn" onclick="addRow()">Dodaj wiersz</button>
    <button class="btn" id="generatePDF">Wygeneruj PDF</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const tbody = document.querySelector("#delegationTable tbody");

        function addRow() {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td><input type="text"></td>
                <td><input type="date"></td>
                <td><input type="time"></td>
                <td><input type="text"></td>
                <td><input type="date"></td>
                <td><input type="time"></td>
                <td>
                    <select onchange="toggleKM(this)">
                        <option value="auto służbowe">Auto służbowe</option>
                        <option value="auto prywatne">Auto prywatne</option>
                        <option value="kolej">Transport kolejowy</option>
                        <option value="lotniczy">Transport lotniczy</option>
                    </select>
                </td>
                <td><input type="number" step="0.01"></td>
                <td><input type="number" step="0.1" disabled></td>
            `;
            tbody.appendChild(row);
        }

        function toggleKM(select) {
            const kmInput = select.parentElement.nextElementSibling.firstElementChild;
            kmInput.disabled = select.value !== "auto prywatne";
        }

        for (let i = 0; i < 3; i++) addRow();

        document.getElementById("generatePDF").addEventListener("click", () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const delegationNumber = document.getElementById("delegationNumber").value || "Brak numeru";

            doc.setFontSize(16);
            doc.text("Kalkulator Diety Krajowej", 105, 15, { align: "center" });
            doc.setFontSize(12);
            doc.text(`Delegacja nr: ${delegationNumber}`, 10, 25);

            const rows = Array.from(tbody.querySelectorAll("tr"));
            let startY = 35;
            doc.setFontSize(10);
            doc.text("Miejsce wyjazdu | Data | Godz. | Miejsce przyjazdu | Data | Godz. | Lokomocja | Koszt (zł) | km", 10, startY);
            startY += 5;

            rows.forEach((row, i) => {
                const inputs = row.querySelectorAll("input, select");
                const values = Array.from(inputs).map(input => input.value || "-");
                const line = values.join(" | ");
                doc.text(line, 10, startY + i * 6);
            });

            doc.save("rachunek_delegacji.pdf");
        });
    </script>
</body>
</html>
